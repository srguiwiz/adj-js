<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <title>Adj Framework - Test Suite</title>
  <style type="text/css">
td {
  padding: 1.0ex;
}
@media print {
  tr, td, img {
    page-break-inside: avoid;
  }
}
h1 {
  font-size: 130%;
}
h2 {
  font-size: 120%;
}
h3 {
  font-size: 110%;
}
h4, h5, h6 {
  font-size: 105%;
}
h1,h2,h3,h4,h5,h6 {
  page-break-after: avoid;
}
 .testInvoked {
  background-color:aqua;
}
 .passedTest {
  background-color:green;
}
 .failedTest {
  background-color:red;
}
 .deemphasize {
  font-size: smaller;
}
  </style>
</head>

<body>
<h1>Adj Framework - Test Suite</h1>

<p class="deemphasize">For more abiut Adj, see the <a href="index.html">user
guide</a>.</p>

<p>This <a href="index.html#L2357">test suite</a> so far runs in contemporary
Firefox, Chrome, Safari, and Internet Explorer 10. Any other browsers <a
href="index.html#L4276">to report</a>?</p>

<p>Font metrics differences between browsers still are a challenge. In this
context, a functioning test suite is a challenge of its own. Problems are not
always an indication of a problem with Adj itself. Overall, having and using
this test suite is much better than not having or not using it.</p>
<iframe id="tif" name="tif" src="test-adj-ex-002-verticalList.svg" width="600"
height="300">
If you see this text then your browser doesn't support iframes.</iframe>


<p>Normally you'd want to 
<input name="" type="button" onclick="runThroughAllDocuments();"
value="Run All Tests" />. To start over cleanly, reload your browser window.</p>

<p>Sometimes, if needed, after selecting a file below, once you see it above,
you can 
<input name="" type="button" onclick="runOneDocument();" value="Run One Test"
/>.</p>

<p>To help debugging, after selecting a file below, once you see it above, you
can force an 
<input name="" type="button" onclick="forceAnAdjDoDoc();" value="Adj.doDoc()"
/>.</p>

<table border="1">
  <tbody id="tb">
    <tr>
      <td><a href="test-adj-ex-002-verticalList.svg"
        target="tif">test-adj-ex-002-verticalList.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-003-horizontalList.svg"
        target="tif">test-adj-ex-003-horizontalList.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-004-frameForParent.svg"
        target="tif">test-adj-ex-004-frameForParent.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-005-textBreaks.svg"
        target="tif">test-adj-ex-005-textBreaks.svg</a><br />
        <span class="deemphasize">has text, may suffer from font metrics
        differences</span></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-006-connection.svg"
        target="tif">test-adj-ex-006-connection.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-007-rider.svg"
        target="tif">test-adj-ex-007-rider.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-008-circleForParent.svg"
        target="tif">test-adj-ex-008-circleForParent.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-009-ellipseForParent.svg"
        target="tif">test-adj-ex-009-ellipseForParent.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-010-circularList.svg"
        target="tif">test-adj-ex-010-circularList.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-045-verticalTree.svg"
        target="tif">test-adj-ex-045-verticalTree.svg</a><br />
        <span class="deemphasize">has text, may suffer from font metrics
        differences</span></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-051-horizontalTree.svg"
        target="tif">test-adj-ex-051-horizontalTree.svg</a><br />
        <span class="deemphasize">has text, may suffer from font metrics
        differences</span></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-053-vine.svg"
        target="tif">test-adj-ex-053-vine.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-054-floater.svg"
        target="tif">test-adj-ex-054-floater.svg</a></td>
      <td>?</td>
    </tr>
  </tbody>
</table>
<script type="text/javascript">
//<![CDATA[
//
// Copyright (c) 2002-2013, Nirvana Research
// All rights reserved.
//
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are met:
//     * Redistributions of source code must retain the above copyright
//       notice, this list of conditions and the following disclaimer.
//     * Redistributions in binary form must reproduce the above copyright
//       notice, this list of conditions and the following disclaimer in the
//       documentation and/or other materials provided with the distribution.
//     * Neither the name of the copyright holder nor the names of
//       contributors may be used to endorse or promote products derived from
//       this software without specific prior written permission.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS "AS IS" AND
// ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
// WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
// DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER BE LIABLE FOR ANY DIRECT,
// INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
// BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
// EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//
// i.e. Modified BSD License
//
// ==============================================================================
//
// Idea and first implementation - Leo Baschy <srguiwiz12 AT nrvr DOT com>
//
// ==============================================================================
//
// Comments to: <adj.feedback AT nrvr DOT com>
//
// ==============================================================================
//
// Public repository - https://github.com/srguiwiz/adj-js
//

	var testIframe = document.getElementById("tif");
	var tbody = document.getElementById("tb");
	var trs = tbody.getElementsByTagName("tr");
	var current = -1;
	var thisPageLocation = window.location.href;
	var thisPageLocationDirectory = thisPageLocation.substring(0, thisPageLocation.lastIndexOf("/") + 1);
	var indexesByUrl = {};
	//
	var ranSomethingAlready = false;
	var runOnlyOne = false;

	function makeAbsoluteAddress(address) {
		if (address.indexOf("://") < 0) {
			address = thisPageLocationDirectory + address;
		}
		return address;
	}

	function initializeSome() {
		for (var i = 0, n = trs.length; i < n; i++) {
			var tr = trs[i];
			var tds = tr.getElementsByTagName("td");
			var tdFile = tds[0];
			var a = tdFile.getElementsByTagName("a")[0];
			var address = a.getAttribute("href");
			address = makeAbsoluteAddress(address);
			indexesByUrl[address] = i;
		}
		//
		testIframe.setAttribute("onload","tifLoaded();");
 	}
	initializeSome();

	function runThroughAllDocuments() {
		if (ranSomethingAlready) {
			alert("You must reload your browser window first.");
			return;
		}
		ranSomethingAlready = true;
		loadFileByNumber(0);
	}

	function runOneDocument() {
		if (ranSomethingAlready) {
			alert("You must reload your browser window first.");
			return;
		}
		ranSomethingAlready = true;
		runOnlyOne = true;
		testIframe.contentWindow.postMessage("Adj.doDocAndVerify|", "*");
	}

	function loadFileByNumber(number) {
		var tr = trs[number];
		var tds = tr.getElementsByTagName("td");
		var tdFile = tds[0];
		var a = tdFile.getElementsByTagName("a")[0];
		var address = a.getAttribute("href");
		address = makeAbsoluteAddress(address);
		console.log("going to load #" + number + " = " + address);
		current = number;
		testIframe.contentWindow.postMessage("load|" + address, "*");
	}

	function tifLoaded() {
		if (current < 0 || current >= trs.length) { // <0 used to flag no interest
			return;
		}
		var tr = trs[current];
		var tds = tr.getElementsByTagName("td");
		var tdResult = tds[1];
		// wait less than a second, for font metrics to work better in some browsers
		tdResult.setAttribute("class","testInvoked");
		tdResult.textContent = "waiting";
		window.setTimeout(function(){
			// invoke test
			tdResult.setAttribute("class","testInvoked");
			tdResult.textContent = "invoked";
			testIframe.contentWindow.postMessage("Adj.doDocAndVerify|", "*");
		},300);
	}

	// match command by itself, or command followed by one or two parameters separated by |
	messageRegexp = /^([^|]*)(?:\|([^|]*))?(?:\|(.*))?$/;

	windowReceivesMessage = function windowReceivesMessage(evt) {
		// accept any evt.origin
		var messageCommand;
		var messageParameter;
		var messageMatch = messageRegexp.exec(evt.data);
		if (messageMatch) {
			messageCommand = messageMatch[1];
			messageParameter1 = messageMatch[2];
			messageParameter2 = messageMatch[3];
		} else {
			messageCommand = "";
		}
		switch (messageCommand) {
			case "Adj.didDocAndVerify":
			case "Adj.didDocAndVerifyException":
				if (messageCommand == "Adj.didDocAndVerify") {
					displayTestResult(messageParameter1,messageParameter2,false);
				} else {
					displayTestResult(messageParameter1,messageParameter2,true);
				}
				// iterate
				if (!runOnlyOne) {
					// wait less than a second, to allow a user to catch a glimpse of the image
					window.setTimeout(function(){
						continueToNext();
					},700);
				} else { // runOnlyOne
					current = trs.length;
				}
				break;
			default:
		}
	}

	// see https://developer.mozilla.org/en-US/docs/DOM/window.postMessage
	window.addEventListener("message", windowReceivesMessage, false);

	function displayTestResult(testedUrl, testResult, wasException) {
		var index = indexesByUrl[testedUrl];
		if (typeof index != "number") {
			console.log("cannot figure what row has URL " + testedUrl);
			return;
		}
		var tr = trs[index];
		var tds = tr.getElementsByTagName("td");
		var tdResult = tds[1];
		if (!wasException) {
			if (!testResult) { // empty string if expected result == success
				tdResult.setAttribute("class","passedTest");
				tdResult.textContent = "PASSED";
			} else {
				tdResult.setAttribute("class","failedTest");
				tdResult.textContent = "FAILED with: " + testResult;
			}
		} else {
			tdResult.setAttribute("class","failedTest");
			tdResult.textContent = "FAILED with exception: " + testResult;
		}
	}

	function continueToNext() {
		// continue to next row / file
		current += 1;
		if (current < trs.length) {
			loadFileByNumber(current);
		}
	}

	function forceAnAdjDoDoc() {
		ranSomethingAlready = true;
		testIframe.contentWindow.postMessage("Adj.doDoc|", "*");
	}
  //]]></script>
</body>
</html>
