<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <title>Adj Framework - Test Suite</title>
  <script type="text/javascript" src="js/adj.js">
  </script>
  <style type="text/css">
td {
  padding: 1.0ex;
}
@media print {
  tr, td, img {
    page-break-inside: avoid;
  }
}
h1 {
  font-size: 130%;
}
h2 {
  font-size: 120%;
}
h3 {
  font-size: 110%;
}
h4, h5, h6 {
  font-size: 105%;
}
h1,h2,h3,h4,h5,h6 {
  page-break-after: avoid;
}
 .testInvoked {
  background-color:aqua;
}
 .passedTest {
  background-color:green;
}
 .failedTest {
  background-color:red;
}
 .deemphasize {
  font-size: smaller;
}
@font-face {
  font-family: Liberation Mono;
  src: local("Liberation Mono"), local("Liberation Mono Regular"), local("LiberationMono-Regular"), url(fonts/Liberation/LiberationMono-Regular.ttf);
  font-weight: normal;
  font-style: normal;
}
 .liberationMono {
  font-family: "Liberation Mono","Courier New";
}
  </style>
</head>

<body>
<h1>Adj Framework - Test Suite</h1>

<div class="toc">
<ul>
  <li><a href="#L3557">1. Compatibility</a></li>
  <li><a href="#L2744">2. Run</a></li>
  <li><a href="#L3113">3. History</a></li>
</ul>
</div>

<p>For more about Adj, see the <a href="index.html">user guide</a>.</p>

<h2 id="L3557">1. Compatibility</h2>

<p>This <a href="index.html#L2357">test suite</a> for Adj <a
href="https://github.com/srguiwiz/adj-js">version</a> <strong
class="adjversion">?</strong> so far <a href="#L2744">runs</a> in contemporary
Firefox 43 (Windows, Linux), Chrome 48 (Windows, Mac OS X, Android 4.4), Safari
9 (Mac OS X, iOS 9.1 on iPhone and iPad), Opera 34 (Windows) and Internet
Explorer 11. Do you have other browsers <a href="index.html#L4276">to
report</a>?</p>

<p>Starting in 2015 we <strong>have observed computer virus protection
injecting scripts into web pages</strong>. Such extraneous elements cause this
test suite to incorrectly report failure: Even though having run correctly,
<strong>extraneous elements don't identifiably match expected results</strong>.
If encountered, there is a known workaround: <strong>Run this test suite on a
machine without that specific virus protection</strong>. In case you are
wondering: "Pause protectionâ€¦" confirmably doesn't stop script injection with
at least one well known brand name.</p>

<p>Font metrics differences between browsers still are a challenge. In this
context, a functioning test suite is a challenge of its own. Problems are not
always an indication of a problem with Adj itself. Overall, having and using
this test suite is much better than not having or not using it.</p>

<p>In addition to other font metric related issues, some versions of WebKit
based browsers may have an issue apparently still loading web based fonts while
already drawing an SVG image and hence not knowing the correct metric yet. This
seems to be more noticeable on the weaker CPU of a mobile device, such as an
iPad. If that would cause test failures then simply <strong>running this test
suite a second time appears to work better</strong>, possibly because the font
might be cached on the device already. Maybe this page loading the font <span
class="liberationMono">here</span> already helps too.</p>

<p>Furthermore, it has been observed than apparently hanging (not completing)
tests with asynchronous code <span class="deemphasize">(testing command <a
href="index.html#L3450"><code>include</code></a>)</span> <strong>often succed
when run a second time</strong>.</p>

<h2 id="L2744">2. Run</h2>
<iframe id="tif" name="tif" src="test-adj-ex-002-verticalList.svg" width="600"
height="300">
If you see this text then your browser doesn't support iframes.</iframe>


<p>Normally you'd want to 
<input name="" type="button" onclick="runThroughAllDocuments();"
value="Run All Tests" />. To start over cleanly, reload your browser window.</p>

<p>Sometimes, if needed, after selecting a file below, once you see it above,
you can 
<input name="" type="button" onclick="runOneDocument();" value="Run One Test"
/>.</p>

<p>To help debugging, after selecting a file below, once you see it above, you
can force an 
<input name="" type="button" onclick="forceAnAdjDoSvg();" value="Adj.doSvg()"
/>.</p>

<table border="1">
  <thead>
    <tr>
      <th colspan="2"><p>Adj version <strong class="adjversion">?</strong></p>
      </th>
    </tr>
  </thead>
  <tbody id="tb">
    <tr>
      <td><a href="test-adj-ex-002-verticalList.svg"
        target="tif">test-adj-ex-002-verticalList.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-003-horizontalList.svg"
        target="tif">test-adj-ex-003-horizontalList.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-004-frameForParent.svg"
        target="tif">test-adj-ex-004-frameForParent.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-005-textBreaks.svg"
        target="tif">test-adj-ex-005-textBreaks.svg</a><br />
        <span class="deemphasize">has text, may suffer from font metrics
        differences</span></td>
      <td><p>?</p>
      </td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-006-connection.svg"
        target="tif">test-adj-ex-006-connection.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-007-rider.svg"
        target="tif">test-adj-ex-007-rider.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-008-circleForParent.svg"
        target="tif">test-adj-ex-008-circleForParent.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-009-ellipseForParent.svg"
        target="tif">test-adj-ex-009-ellipseForParent.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-010-circularList.svg"
        target="tif">test-adj-ex-010-circularList.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-023-connection-fromXY-explained.svg"
        target="tif">test-adj-ex-023-connection-fromXY-explained.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-045-verticalTree.svg"
        target="tif">test-adj-ex-045-verticalTree.svg</a><br />
        <span class="deemphasize">has text, may suffer from font metrics
        differences</span></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-051-horizontalTree.svg"
        target="tif">test-adj-ex-051-horizontalTree.svg</a><br />
        <span class="deemphasize">has text, may suffer from font metrics
        differences</span></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-053-vine.svg"
        target="tif">test-adj-ex-053-vine.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-054-floater.svg"
        target="tif">test-adj-ex-054-floater.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-056-explain-path-transform.svg"
        target="tif">test-adj-ex-056-explain-path-transform.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-057b-variable-scope.svg"
        target="tif">test-adj-ex-057b-variable-scope.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-060-fit.svg"
        target="tif">test-adj-ex-060-fit.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-061-stackFrames.svg"
        target="tif">test-adj-ex-061-stackFrames.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-063-zoomFrames.svg"
        target="tif">test-adj-ex-063-zoomFrames.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-066-tilt.svg"
        target="tif">test-adj-ex-066-tilt.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-068-skimpyList.svg"
        target="tif">test-adj-ex-068-skimpyList.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-070-pinnedList.svg"
        target="tif">test-adj-ex-070-pinnedList.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-072-hide.svg"
        target="tif">test-adj-ex-072-hide.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-075-telescopicTree.svg"
        target="tif">test-adj-ex-075-telescopicTree.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-077-paragraph.svg"
        target="tif">test-adj-ex-077-paragraph.svg</a><br />
        <span class="deemphasize">has text, may suffer from font metrics
        differences</span></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-077-paragraph-issue-12a.svg"
        target="tif">test-adj-ex-077-paragraph-issue-12a.svg</a><br />
        <span class="deemphasize">has text, may suffer from font metrics
        differences</span></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-078-paragraph-hAlign.svg"
        target="tif">test-adj-ex-078-paragraph-hAlign.svg</a><br />
        <span class="deemphasize">has text, may suffer from font metrics
        differences</span></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-082-pathArrow.svg"
        target="tif">test-adj-ex-082-pathArrow.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-084-pathArrow-nockSetback-pointSetback.svg"
        target="tif">test-adj-ex-084-pathArrow-nockSetback-pointSetback.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-086-pathArrow-arithmetic.svg"
        target="tif">test-adj-ex-086-pathArrow-arithmetic.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-087-circularList-packArc.svg"
        target="tif">test-adj-ex-087-circularList-packArc.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-090-rcGrid-motley.svg"
        target="tif">test-adj-ex-090-rcGrid-motley.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-091-rcGrid-templates.svg"
        target="tif">test-adj-ex-091-rcGrid-templates.svg</a></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-080-include.svg"
        target="tif">test-adj-ex-080-include.svg</a><br />
        <span class="deemphasize">known to fail in file:// scheme unless
        browser permits or is set to permit;</span><br />
        <span class="deemphasize">if so then you should try running in http://
        scheme, e.g. <a
        href="https://srguiwiz.github.com/adj-js/user-docs/tests.html">here</a></span></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-081-include-fragment.svg"
        target="tif">test-adj-ex-081-include-fragment.svg</a><br />
        <span class="deemphasize">known to fail in file:// scheme unless
        browser permits or is set to permit;</span><br />
        <span class="deemphasize">if so then you should try running in http://
        scheme, e.g. <a
        href="https://srguiwiz.github.com/adj-js/user-docs/tests.html">here</a></span></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-002-verticalList.html"
        target="tif">test-adj-ex-002-verticalList.html</a> HTML</td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-023-connection-fromXY-explained.html"
        target="tif">test-adj-ex-023-connection-fromXY-explained.html</a>
      HTML</td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-063-zoomFrames.html"
        target="tif">test-adj-ex-063-zoomFrames.html</a> HTML</td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-090-rcGrid-motley.html"
        target="tif">test-adj-ex-090-rcGrid-motley.html</a> HTML</td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-091-rcGrid-templates.html"
        target="tif">test-adj-ex-091-rcGrid-templates.html</a> HTML</td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-080-include.html"
        target="tif">test-adj-ex-080-include.html</a> HTML<br />
        <span class="deemphasize">known to fail in file:// scheme unless
        browser permits or is set to permit;</span><br />
        <span class="deemphasize">if so then you should try running in http://
        scheme, e.g. <a
        href="https://srguiwiz.github.com/adj-js/user-docs/tests.html">here</a></span></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-002-verticalList-and-more.html"
        target="tif">test-adj-ex-002-verticalList-and-more.html</a> HTML<br />
        <span class="deemphasize">known to fail in file:// scheme unless
        browser permits or is set to permit;</span><br />
        <span class="deemphasize">if so then you should try running in http://
        scheme, e.g. <a
        href="https://srguiwiz.github.com/adj-js/user-docs/tests.html">here</a></span></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-081-include-fragment-from-html.html"
        target="tif">test-adj-ex-081-include-fragment-from-html.html</a><br />
        <span class="deemphasize">known to fail in file:// scheme unless
        browser permits or is set to permit;</span><br />
        <span class="deemphasize">if so then you should try running in http://
        scheme, e.g. <a
        href="https://srguiwiz.github.com/adj-js/user-docs/tests.html">here</a></span></td>
      <td>?</td>
    </tr>
    <tr>
      <td><a href="test-adj-ex-081-include-fragment-from-html.svg"
        target="tif">test-adj-ex-081-include-fragment-from-html.svg</a><br />
        <span class="deemphasize">known to fail in file:// scheme unless
        browser permits or is set to permit;</span><br />
        <span class="deemphasize">if so then you should try running in http://
        scheme, e.g. <a
        href="https://srguiwiz.github.com/adj-js/user-docs/tests.html">here</a></span></td>
      <td>?</td>
    </tr>
  </tbody>
</table>

<h2 id="L3113">3. History</h2>

<p>This test suite has been run and updated since Firefox 24, Chrome 35, Safari
5, and Internet Explorer 10. Compatibility to such older versions browsers,
however, is not currently verified.</p>
<script type="text/javascript">
//<![CDATA[
//
// Simplified BSD License
//
// Copyright (c) 2002-2016, Nirvana Research
// All rights reserved.
//
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are met:
//     * Redistributions of source code must retain the above copyright
//       notice, this list of conditions and the following disclaimer.
//     * Redistributions in binary form must reproduce the above copyright
//       notice, this list of conditions and the following disclaimer in the
//       documentation and/or other materials provided with the distribution.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS "AS IS" AND
// ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
// WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
// DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
// ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
// (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
// LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
// ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//
// ==============================================================================
//
// Idea and first implementation - Leo Baschy <srguiwiz12 AT nrvr DOT com>
//
// ==============================================================================
//
// Project contact: <adj.project AT nrvr DOT com>
//
// ==============================================================================
//
// Public repository - https://github.com/srguiwiz/adj-js
//
	var versionInstances = document.querySelectorAll('.adjversion');
	for (var i = 0, n = versionInstances.length; i < n; i++) {
		versionInstances[i].innerHTML=Adj.version.major+'.'+Adj.version.minor+'.'+Adj.version.revision;
	}

	var testIframe = document.getElementById("tif");
	var tbody = document.getElementById("tb");
	var trs = tbody.getElementsByTagName("tr");
	var current = -1;
	var thisPageLocation = window.location.href;
	var thisPageLocationDirectory = thisPageLocation.substring(0, thisPageLocation.lastIndexOf("/") + 1);
	var indexesByUrl = {};
	//
	var ranSomethingAlready = false;
	var runOnlyOne = false;

	function makeAbsoluteAddress(address) {
		if (address.indexOf("://") < 0) {
			address = thisPageLocationDirectory + address;
		}
		return address;
	}

	function initializeSome() {
		for (var i = 0, n = trs.length; i < n; i++) {
			var tr = trs[i];
			var tds = tr.getElementsByTagName("td");
			var tdFile = tds[0];
			var a = tdFile.getElementsByTagName("a")[0];
			var address = a.getAttribute("href");
			address = makeAbsoluteAddress(address);
			indexesByUrl[address] = i;
		}
		//
		testIframe.setAttribute("onload","tifLoaded();");
 	}
	initializeSome();

	function runThroughAllDocuments() {
		if (ranSomethingAlready) {
			alert("You must reload your browser window first.");
			return;
		}
		ranSomethingAlready = true;
		loadFileByNumber(0);
	}

	function runOneDocument() {
		if (ranSomethingAlready) {
			alert("You must reload your browser window first.");
			return;
		}
		ranSomethingAlready = true;
		runOnlyOne = true;
		testIframe.contentWindow.postMessage("Adj.doSvgAndVerify|", "*");
	}

	function loadFileByNumber(number) {
		var tr = trs[number];
		var tds = tr.getElementsByTagName("td");
		var tdFile = tds[0];
		var a = tdFile.getElementsByTagName("a")[0];
		var address = a.getAttribute("href");
		address = makeAbsoluteAddress(address);
		console.log("going to load #" + number + " = " + address);
		current = number;
		testIframe.contentWindow.postMessage("load|" + address, "*");
	}

	function tifLoaded() {
		if (current < 0 || current >= trs.length) { // <0 used to flag no interest
			return;
		}
		var tr = trs[current];
		var tds = tr.getElementsByTagName("td");
		var tdResult = tds[1];
		// wait less than a second, for font metrics to work better in some browsers
		tdResult.setAttribute("class","testInvoked");
		tdResult.textContent = "waiting";
		window.setTimeout(function(){
			// invoke test
			tdResult.setAttribute("class","testInvoked");
			tdResult.textContent = "invoked";
			testIframe.contentWindow.postMessage("Adj.doSvgAndVerify|", "*");
		},300);
	}

	// match command by itself, or command followed by one or two parameters separated by |
	var messageRegexp = /^([^|]*)(?:\|([^|]*))?(?:\|(.*))?$/;

	var windowReceivesMessage = function windowReceivesMessage(evt) {
		// accept any evt.origin
		var messageMatch = messageRegexp.exec(evt.data);
		if (messageMatch) {
			var messageCommand = messageMatch[1];
			var messageParameter1 = messageMatch[2];
			var messageParameter2 = messageMatch[3];
		} else {
			messageCommand = "";
		}
		switch (messageCommand) {
			case "Adj.didDocAndVerify":
			case "Adj.didDocAndVerifyException":
				if (messageCommand == "Adj.didDocAndVerify") {
					displayTestResult(messageParameter1,messageParameter2,false);
				} else {
					displayTestResult(messageParameter1,messageParameter2,true);
				}
				// iterate
				if (!runOnlyOne) {
					// wait less than a second, to allow a user to catch a glimpse of the image
					window.setTimeout(function(){
						continueToNext();
					},700);
				} else { // runOnlyOne
					current = trs.length;
				}
				break;
			default:
		}
	}

	// see https://developer.mozilla.org/en-US/docs/DOM/window.postMessage
	window.addEventListener("message", windowReceivesMessage, false);

	function displayTestResult(testedUrl, testResult, wasException) {
		var index = indexesByUrl[testedUrl];
		if (typeof index != "number") {
			console.log("cannot figure what row has URL " + testedUrl);
			return;
		}
		var tr = trs[index];
		var tds = tr.getElementsByTagName("td");
		var tdResult = tds[1];
		if (!wasException) {
			if (!testResult) { // empty string if expected result == success
				tdResult.setAttribute("class","passedTest");
				tdResult.textContent = "PASSED";
			} else {
				tdResult.setAttribute("class","failedTest");
				tdResult.textContent = "FAILED with: " + testResult;
			}
		} else {
			tdResult.setAttribute("class","failedTest");
			tdResult.textContent = "FAILED with exception: " + testResult;
		}
	}

	function continueToNext() {
		// continue to next row / file
		current += 1;
		if (current < trs.length) {
			loadFileByNumber(current);
		}
	}

	function forceAnAdjDoSvg() {
		ranSomethingAlready = true;
		testIframe.contentWindow.postMessage("Adj.doSvg|", "*");
	}
//]]></script>
</body>
</html>
